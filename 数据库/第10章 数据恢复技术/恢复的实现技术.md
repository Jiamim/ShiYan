恢复的实现技术
=========
恢复的基本原理可以用一个词来概况：**冗余**。  
-------------
恢复机制涉及的两个关键问题是：
- 如何建立冗余数据
- 如何利用这些冗余数据实施数据库恢复

建立冗余数据的技术是：
- 数据转储
- 登录日志文件

##数据转储
数据转储是数据库恢复中采用的基本技术。即DBA定期地将整个数据库复制到磁带或另一个磁盘上保存起来的过程。  
这些备用的数据称为backup（后备副本或后援副本）。  
转储十分耗时，不能频繁进行。  
分类：
- [x] 依据存储状态分为：
- 静态转储
- 动态转储
- [x] 依据存储方式分为：
- 海量存储
- 增量存储

|名词|解释|
|---|----
|静态转储|在系统中无运行事务时进行的转储操作。即转储操作开始的时刻，数据库处于一直性状态，而转储期间不允许（或不存在）对数据库的任何存取、修改活动。
|动态转储|在转储期间允许对数据库进行存取或修改。即转储和用户事务可以并发执行。
|海量转储|每次转储全部的数据库
|增量转储|每次只转储上一次转储后更新过的数据

综合之后具体可划分为四类：
- 动态海量转储
- 动态增量转储
- 静态海量转储
- 静态增量转储

##日志
日志文件是用来记录事务对数据库的更新操作的文件。
>不同数据库采用的日志文件格式并不一样

概况起来日志文件主要有两种格式：
- **以记录为单位的日志文件**
- [x] 主要内容包括：
  - 各个事务的开始（BEGIN TRANSACTION）标记
  - 各个事务的结束（COMMIT或ROLLBACK）标记
  - 各个事务的所有更新操作
- [x] 日志记录（上面三个都作为一个日志记录）的内容：
  - 事务标识（标明是哪个事务）
  - 操作的类型（插入、删除或修改）
  - 操作对象（记录的内部标识）
  - 更新前数据的旧值（对插入操作而言，此项为空）
  - 更新后数据的新值（对删除操作而言，此项为空）
- **以数据块为单位的日志文件**
- [x] 日志记录的主要内容包括：
  - 事务标识
  - 被更新的数据块

###日志文件的作用
1. 事务故障恢复和系统故障恢复必须用日志文件
2. 在动态转储方式中必须建立日志文件，后备副本和日志文件结合起来才能有效地恢复数据库
3. 在静态转储方式中，也可以建立日志文件。避免重新运行那些已经完成的事务程序。

###登记日志文件
必须遵循两条原则
- 登记的次序严格按照并发事务执行的时间次序
- 必须先写日志文件，后写数据库

