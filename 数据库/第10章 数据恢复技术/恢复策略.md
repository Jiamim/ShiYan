恢复策略
=========
不同故障的恢复策略和方法不一样
##事物故障的恢复
指的是事务在运行至正常终点前被终止，这是恢复子系统应利用日志文件撤销（UNDO）此事务已对数据库进行的修改。
>由系统自动完成，对用户透明。

###恢复步骤
1. 反向扫描日志文件，查找该事务的更新操作。
2. 对该事务的更新操作执行逆操作。
3. 继续反向扫描日志文件，查找该事务的其他更新操作，并做同样处理。
4. 如此处理下去，直至读到此事务的开始标记，事务故障恢复就完成了。

##系统故障的恢复
系统故障造成数据不一致状态的原因有二：
- 未完成事务对数据库的更新已写入数据库
- 已提交事务对数据库的更新还可能留在缓冲区，没来得及写入数据库

>由系统在重启时自动完成，不需要用户干预。

###恢复步骤
1. 正向扫描日志文件，找出在故障发生前已经提交的事务，将其事务标识记入重做（UNDO）队列。同时找出故障发生时尚未完成的事务，将其事务标识记入撤销队列。
2. 对撤销队列中的各个事务进行撤销（UNDO）处理。
3. 对重做队列中的各个事务进行重做（REDO）处理。

##介质故障的恢复
发生介质故障时，磁盘上的物理数据和日志文件被破坏，这是**最严重的一种故障**。  
恢复方法是重装数据库，然后重做已完成的事务。
>需要DBA介入。
>>但DBA只需要重装最近转储的数据库副本和有关的各日志文件副本，然后执行系统的恢复命令即可，具体的恢复操作扔由DBMS完成。

###恢复步骤
1. 装入最新的数据库后备副本，使数据库恢复到最近一次转储时的[**一致性**](#consistency)状态。
2. 装入相应的日志文件副本，重做已经完成的事务。

--------
###Consistency
一致性（Consistency）就是ACID里面的C。